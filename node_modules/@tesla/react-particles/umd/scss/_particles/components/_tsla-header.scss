@import '~sass-import-once/sass-import-once';
@import '~susy/sass/susy';
@import '../_shared/component-required';

// ------------------------------------------------------------
// BE SURE TO ADJUST THE DOCUMENTATION!
// ------------------------------------------------------------
@import 'tsla-header.documentation';

@import '../base-keyframes';

// Base Animation Map
$menu-map: (
  base-size: $gutter, // Base size everything is based on
  animation-property: all, // Animate everything by default
  animation-duration: 300ms, // Default animation timing  is the same
  animation-entry-velocity: 300ms, // Default exit velocity of animations
  animation-function: ease-in-out, // Default animation function
  animation-delay: '', // Default to no delay on animations
  opacity-to: .25, // Cross hatch middle point
  opacity-from: 1, // Cross hatch start and end
  header-height: 52px, // Header is this high, no higher!
  logo-height: 13px, // Reduce, reuse, recycle
  logo-width: 100px, // Reduce, reuse, recycle
  crosshatch-size: 36%
);

// ------------------------------------------------------------
// -- Menu-specific Mixins
// ------------------------------------------------------------
@mixin crosshatch-fade {
  animation: fade-transition map-get($menu-map, animation-function), map-get($menu-map, animation-duration);
  animation-iteration-count: 1;
  transform-origin: 50% 50%;
}

@include exports('tsla-header') {

  // ------------------------------------------------------------
  // -- Maps
  // ------------------------------------------------------------

  $header-colors: (
    header_default: $grey-2,
    header_alternate: $white,
    header_darkest: $black,
    header_selected_item: $white,
    header_selected_item_dark: $black,
    header_transparent: transparent
  );

  // ------------------------------------------------------------
  // -- Keyframe Animations
  // ------------------------------------------------------------
  @keyframes fade-transition {
    0%,
    100% {
      opacity: map-get($menu-map, opacity-from);
    }

    50% {
      opacity: map-get($menu-map, opacity-to);
    }
  }

  // ------------------------------------------------------------
  // -- Header Component
  // ------------------------------------------------------------
  .tsla-header {

    &-checkbox {
      @include susy-breakpoint($small-desktop) {
        display: none;
      }
      opacity: 0;
      position: absolute;
      top: 0;
      left: map-get($menu-map, base-size);
      margin: 0;
    }

    &-main {

      @include susy-breakpoint($mobile-only) {
        position: sticky;
        width: 100%;
        top: 0;
        transform: translate3d(0, 0, 0);
        transition: transform 300ms ease-in-out;

        .tsla-header-scrolled & {
          transform: translate3d(0, -52px, 0);
        }

        .tsla-prevent-scroll & {
          transform: none;
          transition: 0 0 0;
        }
      }

      @include susy-breakpoint($small-desktop) {
        position: relative;
      }

      z-index: 5000;
      width: 100%;

      [class*='tsla-header-transparent'] &,
      .tsla-header-semitransparent & {

        @include susy-breakpoint($small-desktop) {
          position: absolute;
          transition: background map-get($menu-map, animation-duration) map-get($menu-map, animation-function);
        }

        @include susy-breakpoint($mobile-only) {

          .tsla-header-nav {
            top: 0;
          }

          .tsla-header-main--logo_container {
            z-index: 1550;
          }
        }

      }
    }

    &-main--container {

      .container {

        @include susy-breakpoint($mobile-only) {
          align-content: flex-start;
        }

        @include susy-breakpoint($small-desktop) {
          max-width: none;
          align-content: center;
        }

        overflow: hidden;
        display: flex;
        flex-flow: row nowrap;
        align-items: center;
        justify-content: space-between;
        height: map-get($menu-map, header-height);
      }
    }

    // ------------------------------------------------------------
    // -- Logo
    // ------------------------------------------------------------
    &-main--logo_container {

      @include susy-breakpoint($small-desktop) {
        width: map-get($menu-map, logo-width);
        height: 100%;
      }

      @include susy-breakpoint($mobile-only) {
        width: calc(50% + #{$gutter});
        height: 100%;
        margin-left: -$gutter;
        z-index: 1600;
        position: relative;
        order: 1;
      }

      position: relative;
      top: -1px;
      margin-bottom: 0;
      z-index: 10;

    }

    &-main--logo {
      width: 100%;
      height: 100%;

      text-indent: -999em;
      display: block;
      overflow: hidden;

      &::before {

        @include susy-breakpoint($mobile-only) {
          width: 100%;
          background-position: $gutter center;
        }

        @include susy-breakpoint($small-desktop) {
          background-position: center;
        }

        width: 100%;
        height: 100%;
        display: block;

        content: '';

        background-repeat: no-repeat;
        background-color: map-get($header-colors, header_transparent);
        background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTMiPiAgPGcgZmlsbD0iI0ZGRiI+ICAgIDxwYXRoIGQ9Ik0wIDBjLjMgMS4xIDEuMyAyLjMgMi42IDIuNmg0LjFsLjIuMVYxM2gyLjVWMi43bC4yLS4xaDQuMWMxLjQtLjQgMi4zLTEuNSAyLjYtMi42SDB6TTc3LjggMTNjMS4zLS41IDItMS41IDIuMi0yLjZINjguN1YtLjFoLTIuNXYxM2gxMS42ek00Ny4zIDIuNmg5YzEuMy0uNCAyLjUtMS40IDIuNy0yLjZINDQuOHY3LjdoMTEuNnYyLjdoLTkuMWMtMS40LjQtMi42IDEuNC0zLjIgMi42SDU5VjUuMkg0Ny4zVjIuNnpNODUuNCA1LjJWMTNIODhWNy44aDkuMVYxM2gyLjZWNS4yTTI1LjIgMi42aDkuN2MxLjMtLjMgMi40LTEuNSAyLjYtMi42aC0xNWMuNCAxLjIgMS40IDIuMyAyLjcgMi42TTI1LjIgNy44aDkuN2MxLjMtLjMgMi40LTEuNSAyLjYtMi42aC0xNWMuNCAxLjEgMS40IDIuMyAyLjcgMi42TTI1LjIgMTNoOS43YzEuMy0uMyAyLjQtMS41IDIuNi0yLjZoLTE1Yy40IDEuMiAxLjQgMi40IDIuNyAyLjZNODcuNyAyLjZoOS43YzEuMy0uMyAyLjQtMS41IDIuNi0yLjZIODVjLjMgMS4yIDEuMyAyLjQgMi43IDIuNiIvPiAgPC9nPjwvc3ZnPg==');
        background-size: map-get($menu-map, logo-width) map-get($menu-map, logo-height);

        transition: filter 150ms map-get($menu-map, animation-function);
      }

    }

    // ------------------------------------------------------------
    // -- Mobile Menu Trigger and Styling
    // ------------------------------------------------------------
    &-main--trigger_icon {
      transition: opacity map-get($menu-map, animation-duration) map-get($menu-map, animation-function);
      width: map-get($menu-map, base-size) - 2;
      height: map-get($menu-map, base-size) - 2;
      position: relative;
      display: block;
      opacity: 1;

      &::after {
        transition: map-get($menu-map, animation-property) map-get($menu-map, animation-duration) map-get($menu-map, animation-function) map-get($menu-map, animation-delay);
        top: 45%;
        height: map-get($menu-map, base-size) / 10;
        display: block;
        position: absolute;
        right: 0;
        width: 0;
        content: '';
      }
    }

    &-main--cross_hatch {
      text-indent: 2000px; // arbitrarily large
      left: 0;
      top: map-get($menu-map, crosshatch-size) + 2;
      width: 100%;
      height: map-get($menu-map, base-size) / 10;
      display: block;
      position: absolute;
      content: '';
      transition: right map-get($menu-map, animation-duration) map-get($menu-map, animation-function);

      &::before,
      &::after {
        left: 0;
        width: 100%;
        height: map-get($menu-map, base-size) / 10;
        display: block;
        position: absolute;
        z-index: 10;
        content: '';
        transition: map-get($menu-map, animation-property) map-get($menu-map, animation-duration) map-get($menu-map, animation-function);
      }

      &::before {
        top: -5px;
      }

      &::after {
        top: 5px;
      }
    }

    // ------------------------------------------------------------
    // Render out hidden sub navs. If on mobile AND
    // parent page is selected, display subnav
    // ------------------------------------------------------------
    &-nav {

      @include susy-breakpoint($small-desktop) {
        display: flex;
        flex-flow: row nowrap;
        align-items: stretch;
        justify-content: space-between;
        align-content: center;
        width: calc(100% - #{$gutter * 2});
        position: absolute;
        left: $gutter;
        top: 0;
      }

      @include susy-breakpoint($mobile-only) {
        padding-right: 0;
        width: 50%;
        min-width: 160px;
        height: 100vh;
        clear: both;
        display: block;
        position: fixed;
        top: 0;
        z-index: 1500;
        right: -200%;
        transform: translateZ(0);
        transition: right map-get($menu-map, animation-duration) map-get($menu-map, animation-function);

        .tsla-header-drawer--enter_left & {
          left: -200%;
          transition: left map-get($menu-map, animation-duration) map-get($menu-map, animation-function);
        }

        &::before {
          width: 100%;
          height: map-get($menu-map, header-height);
          display: block;
          position: sticky;
          top: 0;
          left: 0;
          z-index: 1; // stack it above the links, but below the logo

          background-color: map-get($header-colors, header_alternate);
          border-bottom: 1px solid transparentize($grey-e, .5);
          content: '';
        }
      }
    }

    &-nav--list {

      @include susy-breakpoint($mobile-only) {
        font-size: 13px;
        line-height: 18px;

        &::-webkit-scrollbar {
          width: 0;
          height: 0;
          opacity: 0;
          display: none;
          background: transparent;
        }

        .tsla-header-nav--selected {

          .tsla-header-nav--list {
            display: block;
          }
        }
      }

      display: block;

      .tsla-header-nav--list {
        display: none;
        margin-left: map-get($menu-map, base-size);
        padding: map-get($menu-map, base-size) / 2 0 map-get($menu-map, base-size) / 2 map-get($menu-map, base-size) / 2;
      }

      .tsla-header-nav--primary & {

        @include susy-breakpoint($small-desktop) {
          display: flex;
          flex-flow: row nowrap;
          align-items: center;
          justify-content: center;
          align-content: center;
          height: map-get($menu-map, header-height);
        }
      }
    }

    // ------------------------------------------------------------
    // -- Header Items
    // ------------------------------------------------------------

    // Default list item styling
    &-nav--list_item {
      @include susy-breakpoint($small-desktop) {
        @include fontstack-primary('Gotham Medium');

        text-transform: uppercase;
      }

      @include susy-breakpoint($mobile-only) {
        @include fontstack-primary('Gotham Book');
      }

      list-style: none;
    }

    // Default list link styling
    &-nav--list_link {

      @include susy-breakpoint($small-desktop) {
        margin: 0 10px;

        .tsla-header-nav--secondary & {
          margin: 0;
          padding: $gutter $gutter / 2;
          color: $ui-text;
          font-size: 13px;
          border-bottom: 1px solid $grey-d;
        }
      }

      @include susy-breakpoint($mobile-only) {
        margin: 0 $gutter;
        padding: $gutter $gutter / 2;
        color: map-get($header-colors, header_default);
        font-size: $gutter;
        border-bottom: 1px solid $grey-d;

        &:hover {
          transition: color .15s map-get($menu-map, animation-function);
          color: map-get($header-colors, header_default);
        }
      }

      display: block;
      height: 100%;
      line-height: 1.25;
      cursor: pointer;
      transition: color .15s map-get($menu-map, animation-function);

      .tsla-header-nav--selected & {
        transition: color .15s map-get($menu-map, animation-function);
      }
    }

    &-nav--list_item_last {
      @include susy-breakpoint($small-desktop) {
        right: 40px;
        top: 0;
        height: 100%;
        position: absolute;
        display: block;
      }

      display: none;
    }

    // Overrides necessary for Primary Navigation
    &-nav--primary {
      @include susy-breakpoint($small-desktop) {
        text-align: center;
        width: 100%;

        .tsla-header-nav--list_item {
          font-size: 13px;
          line-height: 18px;
        }

        // if there are 2 account links, only 1 of them is the :last-child, therefore
        // we must accommodate for "many" last-children.
        //
        // @TODO this should be temporary and investigate removal for further iterations of
        // the Authentication section (`.tsla-header-nav--list_item_last` is only
        // needed for current tesla.com stack)
        &:last-child,
        .tsla-header-nav--list_item_last {

          @include susy-breakpoint($mobile-only) {
            display: none;
          }

          .tsla-header-nav--list_link {
            display: flex;
            justify-content: center;
            align-content: center;
            align-items: center;
          }
        }
      }

      @include susy-breakpoint($mobile-only) {
        max-height: 100vh;
        overflow: hidden;
        animation: make-larger map-get($menu-map, animation-duration) map-get($menu-map, animation-function);
      }
    }

    // Overrides necessary for Secondary Navigation
    &-nav--secondary {

      @include susy-breakpoint($small-desktop) {
        position: fixed;
        right: -150%;
        top: -$gutter;
        padding: map-get($menu-map, header-height) $gutter $gutter;
        min-width: 200px;
        height: calc(100% + #{$gutter});
        z-index: 30;
        overflow-y: scroll;
        background-color: transparentize(map-get($header-colors, header_alternate), .05);
        border-left: 1px solid $grey-background-color;
        transition: right map-get($menu-map, animation-duration) map-get($menu-map, animation-function);
      }

      @include susy-breakpoint($mobile-only) {
        .tsla-header-nav--parent_nav {
          max-height: 0;
          overflow: hidden;
          animation: make-smaller map-get($menu-map, animation-entry-velocity) map-get($menu-map, animation-function);
        }

        .tsla-header-nav--list_item:last-child {
          padding-bottom: 50px;

          .tsla-header-nav--list_link {
            border-bottom: 0;
          }
        }
      }

      &::-webkit-scrollbar {
        display: none;
      }

    }

    &--more_caret {
      display: inline-block;
      transform: rotate(0);
      transition: transform map-get($menu-map, animation-duration) map-get($menu-map, animation-function);
    }

    &-nav--meta_info {
      @include susy-breakpoint($mobile-only) {
        padding-top: $gutter / 2;
        background-color: transparentize($white, .05);
      }

      @include susy-breakpoint($small-desktop) {
        display: none;
      }

      margin: 0;
      width: 100%;
      left: 0;
      bottom: 0;
      position: fixed;
      font-size: 13px;
      text-align: center;

      &:hover {
        border-top-color: $grey-e;
        transition: border-top-color 150ms linear;
        transform: translate3d(0, 0, 0);

        .tsla-header-nav--meta_link {
          color: $grey-3;
          transition: color 150ms linear;
        }
      }
    }

    &-nav--meta_link {

      @include susy-breakpoint($small-desktop) {
        display: none;
      }

      @include susy-breakpoint($mobile-only) {

        @include fontstack-primary('Gotham Medium');
        display: block;
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0 0 $gutter / 2;
        font-weight: normal;
        text-transform: uppercase;
        color: $black;
        font-size: 13px;
        line-height: 1.25;
        cursor: pointer;
        transform: translate3d(0, 0, 0);
      }
    }
  }

  [for='tsla-header-main--trigger'] {

    display: flex;
    align-items: center;
    justify-content: center;

    order: 2;
    z-index: 1550;

    height: map-get($menu-map, base-size) + 10;
    width: map-get($menu-map, base-size) + 10;
    cursor: pointer;
  }

  [id='tsla-header-main--trigger']:checked {

    ~ [for='tsla-header-main--trigger'] {

      .tsla-header {

        &-main--trigger_icon::after {
          width: 100%;
          transition: map-get($menu-map, animation-property) map-get($menu-map, animation-duration) map-get($menu-map, animation-function);
        }

        &-main--cross_hatch {

          &::before,
          &::after {
            @include crosshatch-fade;
            top: 0;
          }

          &::before {
            @include transform(rotate(45deg));
          }

          &::after {
            @include transform(rotate(-45deg));
          }
        }
      }
    }

    ~ .tsla-header-nav {

      @include susy-breakpoint($mobile-only) {

        right: 0;

        .tsla-header-drawer--enter_left & {
          left: 0;
        }

      }

      overflow: auto;

      &::-webkit-scrollbar {
        display: none;
      }

      &::after {
        opacity: .5;
        transition: opacity map-get($menu-map, animation-duration) map-get($menu-map, animation-function);
      }

      @include susy-breakpoint($small-desktop) {

        .tsla-header-nav--secondary {
          right: 0;
          transition: right map-get($menu-map, animation-duration) map-get($menu-map, animation-function);
        }
      }
    }

    ~ [id='tsla-header-mask'] {
      transition: opacity map-get($menu-map, animation-duration) map-get($menu-map, animation-function);
      opacity: 1;
      height: 100%;
      width: 100%;

      .tsla-header-alternate &,
      .tsla-header-alternate_mobile & {
        @include susy-breakpoint($mobile-only) {
          top: map-get($menu-map, header-height);
        }
      }
    }
  }

  [for='tsla-header-nav--secondary_show'] {

    @include susy-breakpoint($mobile-only) {
      display: block;
    }
    @include susy-breakpoint($small-desktop) {
      display: none;
    }
  }

  [id='tsla-header-nav--secondary_show']:checked {

    ~ .tsla-header-main {

      @include susy-breakpoint($mobile-only) {

        [for='tsla-header-nav--secondary_show'] {
          margin-top: 0;
          font-family: 'Gotham Bold';
        }

        .tsla-header--more_caret {
          transform: rotate(90deg);
          transition: transform map-get($menu-map, animation-duration) map-get($menu-map, animation-function);
        }

        .tsla-header-nav--primary {
          max-height: 0;
          z-index: -1;
          opacity: 0;
          animation: make-smaller map-get($menu-map, animation-entry-velocity) map-get($menu-map, animation-function);
        }

        .tsla-header-nav--secondary {
          overflow: auto;
        }

        .tsla-header-nav--parent_nav {
          max-height: 100%;
          overflow: auto;
          animation: make-larger map-get($menu-map, animation-duration) map-get($menu-map, animation-function);
        }

        .tsla-header-nav--meta_info {
          position: static;
        }
      }
    }
  }

  // ------------------------------------------------------------
  // -- Mobile Mask
  // ------------------------------------------------------------
  [id='tsla-header-mask'] {
    top: 0;
    right: 0;
    width: 0;
    height: 0;
    position: fixed;
    overflow: hidden;
    z-index: 20;
    opacity: 0;
    background-color: transparentize(map-get($header-colors, header_default), .75);
    transition: opacity map-get($menu-map, animation-duration) map-get($menu-map, animation-function);
  }

  // ------------------------------------------------------------
  // -- Scroll Preventer. TODO: move base functionality to a _helpers.scss type file
  // ------------------------------------------------------------
  .tsla-prevent-scroll {

    @include susy-breakpoint($mobile-only) {
      &.tsla-header-drawer--enter_left {
        .tsla-header-main--logo::before {
          filter: invert(100%);
          transition: filter 300ms map-get($menu-map, animation-function) 150ms;
        }
      }

      &.tsla-header-alternate {
        .tsla-header-main--logo::before {
          filter: invert(0);
        }
      }
    }
  }

  // ------------------------------------------------------------
  // -- Header Variations
  // ------------------------------------------------------------
  .tsla-header-main {

    @include susy-breakpoint($mobile-only) {

      .tsla-header-alternate_mobile & {
        background-color: map-get($header-colors, header_alternate);
      }
    }

    @include susy-breakpoint($small-desktop) {

      [class*='tsla-header-transparent'] & {
        background-color: map-get($header-colors, header_transparent);
      }

      .tsla-header-semitransparent & {
        background-color: transparentize(map-get($header-colors, header_default), .25);
      }
    }

    background-color: map-get($header-colors, header_default);

    .tsla-header-alternate & {
      background-color: map-get($header-colors, header_alternate);
      border-bottom: 1px solid transparentize($grey-e, .5);
    }
  }

  .tsla-header-main--logo {

    @include susy-breakpoint($mobile-only) {
      &::before {

        .tsla-header-alternate_mobile & {
          filter: invert(100%);
        }
      }
    }

    @include susy-breakpoint($small-desktop) {

      .tsla-header-transparent--dark & {
        filter: invert(100%);
      }
    }

    .tsla-header-alternate & {
      filter: invert(100%);
    }
  }

  .tsla-header-main--trigger_icon {

    &::after {

      background-color: map-get($header-colors, header_alternate);

      .tsla-header-alternate_mobile & {
        @include susy-breakpoint($mobile-only) {
          background-color: map-get($header-colors, header_default);
        }
      }

      // TODO: Deprecate in v2.8.0
      .tsla-header-transparent & {
        background-color: map-get($header-colors, header_alternate);
      }

      .tsla-header-transparent--light & {
        @include susy-breakpoint($small-desktop) {
          background-color: map-get($header-colors, header_alternate);
        }
      }

      .tsla-header-semitransparent & {
        background-color: map-get($header-colors, header_alternate);
      }

      .tsla-header-alternate & {
        background-color: map-get($header-colors, header_default);
      }

      .tsla-header-transparent--dark & {
        background-color: map-get($header-colors, header_default);
      }
    }
  }

  .tsla-header-main--cross_hatch {
    background-color: map-get($header-colors, header_alternate);

    .tsla-header-alternate & {
      background-color: map-get($header-colors, header_default);
    }

    // TODO: Deprecate in v2.8.0
    .tsla-header-transparent & {
      @include susy-breakpoint($small-desktop) {
        background-color: map-get($header-colors, header_alternate);
      }
      @include susy-breakpoint($mobile-only) {
        background-color: map-get($header-colors, header_alternate);
      }
    }

    .tsla-header-transparent--light & {
      @include susy-breakpoint($mobile-only) {
        background-color: map-get($header-colors, header_alternate);
      }
      // background-color: map-get($header-colors, header_default);
    }

    .tsla-header-transparent--dark & {
      @include susy-breakpoint($small-desktop) {
        background-color: map-get($header-colors, header_default);
      }
    }

    .tsla-header-semitransparent & {
      background-color: map-get($header-colors, header_alternate);
    }

    .tsla-header-alternate_mobile & {
      @include susy-breakpoint($mobile-only) {
        background-color: map-get($header-colors, header_default);
      }
    }

    &::before,
    &::after {

      @include susy-breakpoint($mobile-only) {

        background-color: map-get($header-colors, header_alternate);

        .tsla-header-drawer--enter_left & {
          background-color: map-get($header-colors, header_alternate);
        }

      }
      @include susy-breakpoint($small-desktop) {
        background-color: map-get($header-colors, header_alternate);
      }

      .tsla-header-alternate & {
        @include susy-breakpoint($small-desktop) {
          background-color: map-get($header-colors, header_default);
        }
        @include susy-breakpoint($mobile-only) {
          background-color: map-get($header-colors, header_default);
        }
      }

      // TODO: Deprecate in v2.8.0
      .tsla-header-transparent & {
        @include susy-breakpoint($small-desktop) {
          background-color: map-get($header-colors, header_alternate);
        }
        @include susy-breakpoint($mobile-only) {
          background-color: map-get($header-colors, header_alternate);
        }
      }

      .tsla-header-transparent--light & {
        @include susy-breakpoint($small-desktop) {
          background-color: map-get($header-colors, header_alternate);
        }
        @include susy-breakpoint($mobile-only) {
          background-color: map-get($header-colors, header_alternate);
        }
      }

      .tsla-header-transparent--dark & {
        @include susy-breakpoint($small-desktop) {
          background-color: map-get($header-colors, header_default);
        }
        @include susy-breakpoint($mobile-only) {
          background-color: map-get($header-colors, header_alternate);
        }
      }

      .tsla-header-semitransparent & {
        background-color: map-get($header-colors, header_alternate);
      }

      .tsla-header-alternate_mobile & {
        @include susy-breakpoint($mobile-only) {
          background-color: map-get($header-colors, header_default);
        }
      }
    }
  }

  .tsla-header-nav--list_link {

    @include susy-breakpoint($small-desktop) {
      color: map-get($header-colors, header_alternate);

      .tsla-header-alternate &,
      .tsla-header-transparent--dark & {
        color: map-get($header-colors, header_default);
      }

      .tsla-header-nav--secondary & {
        .tsla-header-transparent--light & {
          color: map-get($header-colors, header_default);
        }
      }

      &:hover {

        .tsla-header-nav--primary & {
          color: transparentize(map-get($header-colors, header_alternate), .5);

          .tsla-header-alternate & {
            color: transparentize(map-get($header-colors, header_selected_item_dark), .5);
          }

          .tsla-header-transparent--dark & {
            color: transparentize(map-get($header-colors, header_selected_item), .5);
          }

          .tsla-header-transparent--light & {
            color: transparentize(map-get($header-colors, header_alternate), .5);
          }
        }
      }
    }
  }

  .tsla-header-nav--selected {

    .tsla-header-nav--list_link {

      .tsla-header-nav--primary & {
        @include susy-breakpoint($small-desktop) {

          color: transparentize(map-get($header-colors, header_selected_item), .5);

          &:hover {
            color: transparentize(map-get($header-colors, header_selected_item), .5);
          }

          .tsla-header-transparent--dark & {
            color: transparentize(map-get($header-colors, header_selected_item), .5);
          }

          .tsla-header-alternate & {
            color: transparentize(map-get($header-colors, header_selected_item_dark), .5);
          }
        }
      }
    }
  }

  .tsla-header-nav {

    @include susy-breakpoint($mobile-only) {
      background-color: map-get($header-colors, header_alternate);
    }
  }

  [id='tsla-header-main--trigger']:checked {

    ~ [for='tsla-header-main--trigger'] {

      .tsla-header-main--trigger_icon {

        &::after {
          background-color: map-get($header-colors, header_transparent);
        }
      }

      .tsla-header-main--cross_hatch {
        background-color: map-get($header-colors, header_transparent);

        .tsla-header-semitransparent & {
          @include susy-breakpoint($mobile-only) {
            background-color: map-get($header-colors, header_transparent);
          }
        }

        &::before,
        &::after {

          @include susy-breakpoint($small-desktop) {
            background-color: map-get($header-colors, header_default);
          }

          @include susy-breakpoint($mobile-only) {
            background-color: map-get($header-colors, header_default);
          }

          .tsla-header-transparent & {
            @include susy-breakpoint($small-desktop) {
              background-color: map-get($header-colors, header_default);
            }
          }

          .tsla-header-transparent--dark & {
            @include susy-breakpoint($small-desktop) {
              background-color: map-get($header-colors, header_default);
            }
            @include susy-breakpoint($mobile-only) {
              background-color: map-get($header-colors, header_alternate);
            }
          }

          .tsla-header-transparent--light & {
            @include susy-breakpoint($small-desktop) {
              background-color: map-get($header-colors, header_default);
            }
            @include susy-breakpoint($mobile-only) {
              background-color: map-get($header-colors, header_default);
            }
          }

          .tsla-header-alternate_mobile & {
            @include susy-breakpoint($mobile-only) {
              background-color: map-get($header-colors, header_default);
            }
          }

          .tsla-header-semitransparent & {
            @include susy-breakpoint($small-desktop) {
              background-color: map-get($header-colors, header_default);
            }
            // @include susy-breakpoint($mobile-only)   { background-color: map-get($header-colors, header_alternate); }
          }

          .tsla-header-semitransparent.tsla-header-alternate_mobile.tsla-header-drawer--enter_left & {
            @include susy-breakpoint($mobile-only) {
              background-color: map-get($header-colors, header_default);
            }
          }
        }
      }
    }
  }

  // ------------------------------------------------------------
  // -- Dev Mode for testing
  // ------------------------------------------------------------
  @if ($dev-mode) {

    @include susy-breakpoint($small-desktop) {

      .code-output {

        .tsla-header-transparent, // TODO: Deprecate in v2.8.0
        .tsla-header-transparent--dark,
        .tsla-header-transparent--light,
        .tsla-header-semitransparent {

          .tsla-header-main {
            background-repeat: no-repeat;
            background-position: center;
            background-size: cover;
          }
        }

        // TODO: Deprecate in v2.8.0
        .tsla-header-transparent {

          .tsla-header-main {
            background-image: url('http://placebacon.net/100/100?image=1');
          }
        }

        .tsla-header-transparent--dark {

          .tsla-header-main {
            background-image: url('http://placebacon.net/100/100?image=2');
          }
        }

        .tsla-header-transparent--light {

          .tsla-header-main {
            background-image: url('http://placebacon.net/100/100?image=3');
          }
        }

        .tsla-header-semitransparent {

          .tsla-header-main {
            background-image: url('http://placebacon.net/100/100?image=4');
          }
        }
      }
    }
  }

  // Logged in vs. logged out state
  .tsla-user_is--logged_out {

    .tsla-link_for-login {
      @include susy-breakpoint($mobile-only) {
        display: block;
      }
      @include susy-breakpoint($small-desktop) {
        opacity: 1;
        z-index: 1;
      }
    }

    .tsla-link_for-logout {
      @include susy-breakpoint($mobile-only) {
        display: none;
      }
      @include susy-breakpoint($small-desktop) {
        opacity: 0;
        z-index: -1;
      }
    }
  }

  .tsla-user_is--logged_in {

    .tsla-link_for-login {
      @include susy-breakpoint($mobile-only) {
        display: none;
      }
      @include susy-breakpoint($small-desktop) {
        opacity: 0;
        z-index: -1;
      }
    }

    .tsla-link_for-logout {

      @include susy-breakpoint($mobile-only) {
        display: block;
      }

      @include susy-breakpoint($small-desktop) {
        opacity: 1;
        z-index: 1;
      }
    }
  }

  .tsla-link_for-login,
  .tsla-link_for-logout {
    position: relative;
    transition: opacity 150ms linear, color 150ms ease-in-out;
  }

  // maybe this is better in _helpers.scss?
  .tsla-subdued {
    color: $grey-6;
  }

}
